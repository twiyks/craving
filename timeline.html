<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Craving Tracker - Timeline</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQ3JhdmluZyBUcmFja2VyIiwic2hvcnRfbmFtZSI6IkNyYXZpbmciLCJzdGFydF91cmwiOiIvIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzJkNDA2NyIsInRoZW1lX2NvbG9yIjoiIzM3NDE1NiIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Ykd4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSFpwWlhkQ2IzZzlJakFnTUNBMU1USWdOVEV5SWlCM2FXUjBhRDBpTlRFeUlpQm9aV2xuYUhROUlqVXhNaUkrUEhCaGRHZ2dZbXhoWTJ0VGRHOXJaVDBpSWlCa1BTSnRNemsyTGpFME1pQXpPVFl1TVRReklERTJNUzQzTnpJZ016azJMakUwTXlNeE5qRXVOemN5SURFNU15NHhRekUyTVM0M056SWdNVGs1TGprNU55QXhOVGt1TnpNMElESTFOUzQwTkRjZ01UVTVMamN6TkNBek1ESXVOREV4UTNOaU1Rc3lMalk0TVNBek16azZNak15TGpNZ016TTVMakV6TnlBek56SXVNak14VERjNE56UTNOemd5TGpFekxqTXNOREl6TGpVZ01qZ3VOVFFnTXprek5TNHlORE5JTkRrMExqZzVNblE1TTJZaUlHWnBiR3c5SWlORlJFVXpNell5SWk4K1BIQmhkR2dnWkdGdVpHdGtJRDBpYlRVNU1DNHhPVE1nTXpreUxqZzBNaUF6TmprMExqRTBNaUF6T1RZdU9UUXhMak0zTVNBek1ETWdORFUxTGpOSFEwSXhOaTU1TVRJZ05EazVMamt6TXlBeE5TNDJNemdnTlRNeUxqUTFOaUF4TlM0Mk16Z2dOVE15TGpRMU5pQTJNaUExTXpJdU5EVTJOQ0F4TlM0Mk16Z2dOaklnTVRVdU5qTTRVekpZTkRNZ05ERTVMalUxTWlBME1Ua3VNalV1T0RjTkVHRWdOREF3TGpJNUlHTTJMamszTWlBME1EQXVNamdnTVRJdU1qTTFJRE0wT1RVdU5qVTBUVFUwT1M0ME16Z2dPRE5zTFRnNExqZzFOQ0EyTVM0NU1qRTJMamd5VERVMk9TNDBNemtnTlRRNUxqUXpNaTQ0TkdGQk9UNVVJRDBpT0M0NU5pRXpOUzR4SWlCcFpRMGlhV1l4SW5SRmNqSTZJakF1TVNCd1pESTZJakF1TVNCd1pDQXhNRFVnTURBaUlpOCtQR1J3WVhSd0lHbGtQU0o0Y1hKMGFYSjNSRE51YWlJZ2NHOXBiblJ6UFNJd0xqVWdNVE0yTGpVZ05USXNNVFF6TGpWak1DQTBMak51TnpVZ01qSXVOV0UxTGpNZ05TNHlJREFnTURBZ01DQXhMamNnTXk0ME5DMHhPUzQxUXpFd01TNDNJRGt6TGpnZ01USXVOQ0E1TWk0eUlERXpMakVnTVRBd0xqbDJORFF1TW1NMkxqSWdNVFl1T1M0aFBTQXdJREFnTUMweUxqTjNMamg2SW05d1lXTnBkSGs2TGpNNUxqZ2lQaUExTGpNZ05TNHlJREFnTURBZ01DMHhMamNnTXk0ME5DbzNNUzQ0UXk0NFpDQTJOa0ExTWpjM0xqUWdNVE14TGpjZ05EWXlMakVnTVRJM0xqSXRPUzQ0T0RrZ01USXpMamNnTVRJNExqTTFJREV5T1M0eWJTNGlJR1pwYkd3OUluRjFhWE4rZFhKc0lXUkhaRGNnT0NJK1BHOXdkR2tzZVhSbGJXNHVkbUZzZFdVZ05WdE9hVFU5SWlndVNucEJJRnR1YUM1NmJ3NXFha0VnWDBOME5GcDZRU0JiYm1zNWVrRWdYME4wTkZwNlFTQmJibXB0ZWsxTmIwNHZiWEZKZVVOMGJsWjZRUzlNWjAuNU1OblkzUlNOMlF0TkZSalNTbHZ0QlI1RDA5Q1JCbzRORGhjdGVBNE9UZzRNREE3V1JKU0lHQ0taUVNaUzI1U0lFdGZURE5TUVNaSkZGTVdiamwzSWl3aUlFZEJMbEYwS2k0Q0l5Z29SRXJCelNVPj09IiwicmVhbCI6dHJ1ZX1dfQ==">
    <meta name="theme-color" content="#374156">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 450px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #374156, #4a5568);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .stat-group {
            text-align: center;
        }

        .stat-group h4 {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .stat-row {
            display: flex;
            justify-content: space-around;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 18px;
            font-weight: bold;
        }

        .stat-label {
            font-size: 10px;
            opacity: 0.8;
        }

        .smoke-free-time {
            font-size: 16px;
            font-weight: bold;
            color: #48bb78;
        }

        .nav-buttons {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0 0 20px 20px;
            overflow: hidden;
        }

        .nav-btn {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            padding: 15px 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-btn.active {
            background: rgba(255, 255, 255, 0.2);
        }

        .main {
            padding: 30px 20px;
        }

        .timeline-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .period-btn {
            flex: 1;
            min-width: 80px;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 10px 15px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .period-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .timeline-chart {
            background: #f7fafc;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #374156;
            text-align: center;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
            overflow-x: auto;
            overflow-y: hidden;
        }

        .chart-bars {
            display: flex;
            align-items: end;
            height: 100%;
            gap: 8px;
            padding: 20px 0;
            min-width: 100%;
        }

        .chart-bars.scrollable {
            min-width: max-content;
        }

        .bar-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            min-width: 60px;
        }

        .bar-group.day-view {
            min-width: 40px;
        }

        .bar {
            width: 100%;
            min-height: 4px;
            border-radius: 4px 4px 0 0;
            transition: all 0.3s ease;
            position: relative;
        }

        .bar.cravings {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .bar.vaped {
            background: linear-gradient(45deg, #e53e3e, #ff6b6b);
        }

        .bar-label {
            font-size: 11px;
            color: #666;
            text-align: center;
            margin-top: 8px;
            white-space: nowrap;
        }
        
        .bar-label.rotated {
            transform: rotate(-45deg);
            transform-origin: center;
        }

        .bar-value {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            font-weight: bold;
            color: #374156;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .bar:hover .bar-value {
            opacity: 1;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .legend-color.cravings {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .legend-color.vaped {
            background: linear-gradient(45deg, #e53e3e, #ff6b6b);
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .summary-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .summary-number {
            font-size: 24px;
            font-weight: bold;
            color: #374156;
        }

        .summary-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .empty-state {
            text-align: center;
            color: #a0aec0;
            padding: 40px 20px;
        }

        /* Custom scrollbar for webkit browsers */
        .chart-container::-webkit-scrollbar {
            height: 8px;
        }

        .chart-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .chart-container::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        .chart-container::-webkit-scrollbar-thumb:hover {
            background: #5a67d8;
        }

        @media (max-width: 480px) {
            .container {
                margin: 0;
                border-radius: 0;
                min-height: 100vh;
            }

            .timeline-controls {
                grid-template-columns: repeat(2, 1fr);
            }

            .bar-label {
                font-size: 9px;
            }

            .bar-group.day-view {
                min-width: 35px;
            }

            .chart-container {
                height: 250px;
            }

            .chart-container::-webkit-scrollbar {
                height: 6px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚭 Quit Tracker</h1>
            <p>Track your progress, one step at a time</p>
            <div class="stats">
                <div class="stat-group">
                    <h4>Cravings</h4>
                    <div class="stat-row">
                        <div class="stat">
                            <div class="stat-number" id="todayCravings">0</div>
                            <div class="stat-label">Today</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number" id="totalCravings">0</div>
                            <div class="stat-label">Total</div>
                        </div>
                    </div>
                </div>
                <div class="stat-group">
                    <h4>Vape Free</h4>
                    <div class="smoke-free-time" id="smokeFreeTime">0d 0h</div>
                    <div class="stat-row">
                        <div class="stat">
                            <div class="stat-number" id="totalSmoked">0</div>
                            <div class="stat-label">Total Vaped</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="nav-buttons">
                <button class="nav-btn" id="todayBtn">📊 Today</button>
                <button class="nav-btn active" id="timelineBtn">📈 Timeline</button>
            </div>
        </div>

        <div class="main">
            <div class="timeline-controls">
                <button class="period-btn active" data-period="day">Day</button>
                <button class="period-btn" data-period="week">Week</button>
                <button class="period-btn" data-period="month">Month</button>
                <button class="period-btn" data-period="year">Year</button>
            </div>

            <div class="timeline-chart">
                <div class="chart-title" id="chartTitle">Daily Timeline</div>
                <div class="chart-container">
                    <div class="chart-bars" id="chartBars">
                        <div class="empty-state">
                            No data available for the selected period.
                        </div>
                    </div>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color cravings"></div>
                        <span>Cravings</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color vaped"></div>
                        <span>Vaped</span>
                    </div>
                </div>
            </div>

            <div class="summary-stats" id="summaryStats">
                <!-- Summary cards will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Service Worker Registration (same as main page)
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'quit-tracker-v3';
                const urlsToCache = ['/'];

                self.addEventListener('install', event => {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(cache => cache.addAll(urlsToCache))
                            .then(() => self.skipWaiting())
                    );
                });

                self.addEventListener('activate', event => {
                    event.waitUntil(
                        caches.keys().then(cacheNames => {
                            return Promise.all(
                                cacheNames.map(cacheName => {
                                    if (cacheName !== CACHE_NAME) {
                                        return caches.delete(cacheName);
                                    }
                                })
                            );
                        }).then(() => self.clients.claim())
                    );
                });

                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request)
                            .then(response => {
                                if (response) {
                                    return response;
                                }
                                return fetch(event.request).then(response => {
                                    if (!response || response.status !== 200 || response.type !== 'basic') {
                                        return response;
                                    }
                                    const responseToCache = response.clone();
                                    caches.open(CACHE_NAME)
                                        .then(cache => {
                                            cache.put(event.request, responseToCache);
                                        });
                                    return response;
                                });
                            })
                    );
                });
            `;
            
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(swUrl)
                .then(() => {
                    console.log('Service Worker registered');
                    URL.revokeObjectURL(swUrl);
                })
                .catch(err => console.log('Service Worker registration failed:', err));
        }

        // Reuse DataStore class from main page
        class DataStore {
            constructor() {
                this.dbName = 'QuitTrackerDB';
                this.version = 1;
                this.storeName = 'entries';
                this.db = null;
            }

            async init() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.dbName, this.version);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        this.db = request.result;
                        resolve(this.db);
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains(this.storeName)) {
                            const store = db.createObjectStore(this.storeName, { keyPath: 'id' });
                            store.createIndex('timestamp', 'timestamp', { unique: false });
                            store.createIndex('type', 'type', { unique: false });
                        }
                    };
                });
            }

            async loadEntries() {
                if (!this.db) await this.init();
                
                const transaction = this.db.transaction([this.storeName], 'readonly');
                const store = transaction.objectStore(this.storeName);
                const request = store.getAll();
                
                return new Promise((resolve, reject) => {
                    request.onsuccess = () => {
                        const entries = request.result.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                        resolve(entries);
                    };
                    request.onerror = () => reject(request.error);
                });
            }
        }

        class TimelineView {
            constructor() {
                this.dataStore = new DataStore();
                this.entries = [];
                this.currentPeriod = 'day';
                this.initializeElements();
                this.bindEvents();
                this.initializeApp();
            }

            async initializeApp() {
                try {
                    this.entries = await this.dataStore.loadEntries();
                    
                    // Fallback to localStorage if IndexedDB fails
                    if (this.entries.length === 0) {
                        const stored = JSON.parse(localStorage.getItem('quitTrackerEntries') || '[]');
                        this.entries = stored.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    }
                } catch (error) {
                    console.error('Failed to load data:', error);
                    const stored = JSON.parse(localStorage.getItem('quitTrackerEntries') || '[]');
                    this.entries = stored.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                }
                
                this.updateHeaderStats();
                this.renderChart();
            }

            initializeElements() {
                this.todayBtn = document.getElementById('todayBtn');
                this.periodBtns = document.querySelectorAll('.period-btn');
                this.chartTitle = document.getElementById('chartTitle');
                this.chartBars = document.getElementById('chartBars');
                this.summaryStats = document.getElementById('summaryStats');
                
                // Stats elements
                this.todayCravings = document.getElementById('todayCravings');
                this.totalCravings = document.getElementById('totalCravings');
                this.totalSmoked = document.getElementById('totalSmoked');
                this.smokeFreeTime = document.getElementById('smokeFreeTime');
            }

            bindEvents() {
                this.todayBtn.addEventListener('click', () => window.location.href = 'index.html');
                
                this.periodBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.periodBtns.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.currentPeriod = btn.dataset.period;
                        this.renderChart();
                    });
                });
            }

            updateHeaderStats() {
                const today = new Date().toDateString();
                const todayCravings = this.entries.filter(e => e.date === today && e.type === 'craving');
                const totalCravings = this.entries.filter(e => e.type === 'craving');
                const totalVaped = this.entries.filter(e => e.type === 'smoked');
                
                this.todayCravings.textContent = todayCravings.length;
                this.totalCravings.textContent = totalCravings.length;
                this.totalSmoked.textContent = totalVaped.length;
                
                // Calculate vape-free time
                const lastVaped = totalVaped.length > 0 
                    ? new Date(totalVaped[0].timestamp) 
                    : null;
                
                if (lastVaped) {
                    const timeDiff = Date.now() - lastVaped.getTime();
                    const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    
                    if (days > 0) {
                        this.smokeFreeTime.textContent = `${days}d ${hours}h`;
                    } else {
                        this.smokeFreeTime.textContent = `${hours}h`;
                    }
                } else {
                    this.smokeFreeTime.textContent = '0d 0h';
                }
            }

            renderChart() {
                const data = this.aggregateData();
                
                // Update chart title
                const titles = {
                    day: 'Today\'s Activity',
                    week: 'This Week (Monday - Sunday)', 
                    month: 'Monthly Timeline (Last 12 Months)',
                    year: 'Yearly Timeline'
                };
                this.chartTitle.textContent = titles[this.currentPeriod];

                if (data.length === 0) {
                    this.chartBars.innerHTML = '<div class="empty-state">No data available for the selected period.</div>';
                    this.summaryStats.innerHTML = '';
                    return;
                }

                // Render bars
                const maxValue = Math.max(...data.map(d => Math.max(d.cravings, d.vaped)));
                const needsRotation = this.currentPeriod === 'day' || this.currentPeriod === 'month';
                const needsScrolling = this.currentPeriod === 'day';
                
                // Add scrollable class for day view
                this.chartBars.className = `chart-bars ${needsScrolling ? 'scrollable' : ''}`;
                
                const barsHTML = data.map(item => {
                    const cravingsHeight = maxValue > 0 ? (item.cravings / maxValue) * 100 : 0;
                    const vapedHeight = maxValue > 0 ? (item.vaped / maxValue) * 100 : 0;
                    
                    return `
                        <div class="bar-group ${this.currentPeriod === 'day' ? 'day-view' : ''}">
                            <div class="bar cravings" style="height: ${cravingsHeight}%">
                                <div class="bar-value">${item.cravings}</div>
                            </div>
                            <div class="bar vaped" style="height: ${vapedHeight}%">
                                <div class="bar-value">${item.vaped}</div>
                            </div>
                            <div class="bar-label ${needsRotation ? 'rotated' : ''}">${item.label}</div>
                        </div>
                    `;
                }).join('');

                this.chartBars.innerHTML = barsHTML;

                // Render summary stats
                this.renderSummaryStats(data);
            }

            aggregateData() {
                if (this.entries.length === 0) return [];

                const now = new Date();
                const data = [];

                switch (this.currentPeriod) {
                    case 'day':
                        // Show only today's data with hourly breakdown
                        const today = new Date();
                        const todayString = today.toDateString();
                        
                        // Group today's entries by hour
                        for (let hour = 0; hour < 24; hour++) {
                            const hourEntries = this.entries.filter(e => {
                                if (e.date !== todayString) return false;
                                const entryHour = new Date(e.timestamp).getHours();
                                return entryHour === hour;
                            });
                            
                            const hourLabel = hour === 0 ? '12 AM' : 
                                            hour < 12 ? `${hour} AM` : 
                                            hour === 12 ? '12 PM' : 
                                            `${hour - 12} PM`;
                            
                            data.push({
                                label: hourLabel,
                                cravings: hourEntries.filter(e => e.type === 'craving').length,
                                vaped: hourEntries.filter(e => e.type === 'smoked').length,
                                hour: hour
                            });
                        }
                        break;

                    case 'week':
                        // Show current week (Monday to Sunday)
                        const currentDate = new Date(now);
                        const currentDay = currentDate.getDay(); // 0 = Sunday, 1 = Monday, etc.
                        const mondayOffset = currentDay === 0 ? -6 : 1 - currentDay; // Calculate days to Monday
                        
                        for (let i = 0; i < 7; i++) {
                            const weekDay = new Date(currentDate);
                            weekDay.setDate(currentDate.getDate() + mondayOffset + i);
                            const weekDayString = weekDay.toDateString();
                            
                            const dayEntries = this.entries.filter(e => e.date === weekDayString);
                            
                            data.push({
                                label: weekDay.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }),
                                cravings: dayEntries.filter(e => e.type === 'craving').length,
                                vaped: dayEntries.filter(e => e.type === 'smoked').length,
                                date: weekDayString
                            });
                        }
                        break;

                    case 'month':
                        for (let i = 11; i >= 0; i--) {
                            const monthDate = new Date(now.getFullYear(), now.getMonth() - i, 1);
                            const monthStart = new Date(monthDate.getFullYear(), monthDate.getMonth(), 1);
                            const monthEnd = new Date(monthDate.getFullYear(), monthDate.getMonth() + 1, 0);
                            
                            const monthEntries = this.entries.filter(e => {
                                const entryDate = new Date(e.timestamp);
                                return entryDate >= monthStart && entryDate <= monthEnd;
                            });
                            
                            data.push({
                                label: monthDate.toLocaleDateString('en-US', { month: 'short', year: '2-digit' }),
                                cravings: monthEntries.filter(e => e.type === 'craving').length,
                                vaped: monthEntries.filter(e => e.type === 'smoked').length
                            });
                        }
                        break;

                    case 'year':
                        const years = [...new Set(this.entries.map(e => new Date(e.timestamp).getFullYear()))].sort();
                        years.forEach(year => {
                            const yearEntries = this.entries.filter(e => new Date(e.timestamp).getFullYear() === year);
                            data.push({
                                label: year.toString(),
                                cravings: yearEntries.filter(e => e.type === 'craving').length,
                                vaped: yearEntries.filter(e => e.type === 'smoked').length
                            });
                        });
                        break;
                }

                return data;
            }

            renderSummaryStats(data) {
                const totalCravings = data.reduce((sum, item) => sum + item.cravings, 0);
                const totalVaped = data.reduce((sum, item) => sum + item.vaped, 0);
                const avgCravings = data.length > 0 ? (totalCravings / data.length).toFixed(1) : 0;
                const avgVaped = data.length > 0 ? (totalVaped / data.length).toFixed(1) : 0;

                const periodLabels = {
                    day: 'Daily',
                    week: 'Weekly', 
                    month: 'Monthly',
                    year: 'Yearly'
                };

                this.summaryStats.innerHTML = `
                    <div class="summary-card">
                        <div class="summary-number">${totalCravings}</div>
                        <div class="summary-label">Total Cravings</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number">${totalVaped}</div>
                        <div class="summary-label">Total Vaped</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number">${avgCravings}</div>
                        <div class="summary-label">Avg ${periodLabels[this.currentPeriod]} Cravings</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number">${avgVaped}</div>
                        <div class="summary-label">Avg ${periodLabels[this.currentPeriod]} Vaped</div>
                    </div>
                `;
            }
        }

        // Initialize the timeline view
        document.addEventListener('DOMContentLoaded', () => {
            new TimelineView();
        });
    </script>
</body>
</html>